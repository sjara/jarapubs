# 2022paspeech
Characterization of how neuronal populations in A1 and non-primary AC regions encode FT, VOT, and combinations of FT and VOT

# Producing databases
The file `studyparams.py` contains the list of animals used in this study as well as
relevant file paths and statistical parameters for the database calculations

## `database_generation.py`
* `database_cell_locations.py`: Estimates which brain area each cell is from using the processed histology data and the allen average mouse brain atlas.
* `database_tone_responsive.py`: Estimate responses to pure tones. It creates `SUBJECT_paspeech_tones_pval.h5` (it takes 3 min)
* `database_freq_tuning.py`: Estimate frequency tuning. It creates `SUBJECT_paspeech_freq_tuning.h5` (it takes 1 min)
* `database_am_responsiveness.py`: Estimate responses to AM sounds. It creates `SUBJECT_paspeech_am_pval.h5` (it takes 2 min)
* `database_am_tuning.py`: Estimate tuning to AM rate. It creates `SUBJECT_paspeech_am_tuning.h5` (it takes 42s)
* `database_speech_responsive.py`: Estimates responsiveness to speech sounds (FT and VOT). It creates `SUBJECT_paspeech_speech_pval.h5` (it takes 3.5 min)
* `database_speech_selective.py`: Estimates selectivity to FT and VOT. It creates `SUBJECT_speech_tuning.h5` (it takes 2 min)

# For all databases, "BEST" indicates the maximum absolute value difference between the mean firing rate for a given stimulus (e.g. modulation rate) and baseline firing rate for each cell.

## `database_generation_funcs.py`
Contains functions called during database generation.


# Database contents

The initial database is generated by `celldatabase.generate_cell_database_from_subjects()`, as part of the `database_cell_locations.py` script. It contains columns according to the inforec files (``subject``, ``date``, etc) and the spike sorting results (``cluster``, ``spikeShape``, etc). It also creates columns `x_coord`, `y_coord`, `z_coord`, and `recordingSiteName`, which are the coordinates in allen CCF space and the brain area label for that location in the CCF.
`SUBJECT_paspeech_tones_pval.h5` adds columns for `amMinPvalOnset`, which is the minimum pValue (wilcoxon) from the comparison between the evoked firing rate from the onset (first 100ms) of each AM stimulus and the baseline firing rate. `amIndexMinPvalOnset`, which is the index of which AM stimulus has the minimum pvalue, 'amFiringRateBaseline', is the average baseline firing rate (200ms before stimulus onset) for each cell. `amFiringRateBestOnset` is the firing rate from the stimulus that had the maximum (absolute value) difference between the mean firing rate for a given modulation rate and baseline firing rate for each cell. `amIndexBestOnset` is the index of which am stimulus was the best. `amFiringRateMaxOnset` and `amFiringRateMinOnset` are the max/min of the evoked firing rate averaged by AM stimulus. All of these measures are repeated for the `Sustain` period of the stimulus presentation (100-500ms of the AM stimulus).
`SUBJECT_paspeech_am_tuning.h5` adds columns for `amSelectivityPvalOnset` and `amSelectivityPvalSustain`, which are the pvalues from the kruskal-wallis h test comparing the spike counts for each AM rate during the Onset (0-100ms) and Sustain (100-500ms) periods of the AM stimulus. `amMaxSyncRate` which is the highest AM rate the cell phase-locks to.
`SUBJECT_paspeech_tones_pval` adds columns for `toneMinPval` and `toneIndexMinPval` which are the minimum pvalue (wilcoxon) and index of the stimulus that had the minPval for the comparison between the evoked firing rate (for each stimulus) and baseline firing rate (200ms before stimulus onset). `toneFiringRateBaseline` which is the average baseline firing rate for each cell. `toneFiringRateBest` and `toneIndexBest` which is the firing rate (and index of which tone was "best") to the stimulus that evoked the maximum difference (absolute value) between evoked firing rate and the baseline firing rate.
`SUBJECT_paspeech_freq_tuning`: adds columns for `toneSelectivityPval`, which is the pvalue for the Kruskal-wallis test comparing the firing rates during the stimulus presentation for each pure tone presented. `toneFiringRateBest` and `toneIndexBest`, which are the firing rate and index as to which stimulus evoked the maximum difference (absolute value) between the evoked firing rate and the baseline firing rate. there is a "best" for both onset and Sustain periods (0 - 50ms and 50-100ms, respectively). `toneIntensityThreshold` and `toneCharactFreq` which are the lowest intensity presented that elicited a response from the cell and the charateristic frequency for each cell. and parameters for the gaussian fit to the tuning data: `toneGaussianRsquare`, `toneGaussianA`, `toneGaussianX0`, `toneGaussianSigma` and `toneGaussianY0`.
`SUBJECT_paspeech_speech_pval`: adds columns for `speechMinPvalOnset`, `ftIndexBestOnset`, `votIndexBestOnset`, which is the minimum pvalue (wilcoxon) and the ft and vot indices (respectively) for the comparison between the evoked firing rate during the onset (0-120ms) and the baseline firing rate (200ms before stimulus onset).`speechFiringRateBaseline` is the baseline firing rate for each cell. `speechFiringRateBestOnset`, `ftIndexBestOnset`, `votIndexBestOnset` which is the average firing rate and the ft/vot indices of the stimulus that evoked the maximum difference (absolute value) between the stimulus evoked and baseline firing rates. `speechFiringRateMaxOnset` amd `speechFiringRateMinOnset` are the max/min of the evoked firing rate averaged by speech stimulus. All of these measures are repeated for the `Sustain` period of the stimulus presentation (120-240ms).
`SUBJECT_speech_tuning`: adds columns for `ftSelectivityVotMaxPvalOnset`, `ftSelectivityVotMinPvalOnset` which are the pvalues from the kruskal-wallis test comparing the evoked firing rates (during the onset period, 0-120ms) to each FT stimulus level when VOT is held constant at max or min, respectively. These measures are also calculated for VOT (where FT is held constant at either min or max) and during the sustain period (120-240ms). `selectivityIndexFT_VOTmax`, `selectivityIndexFT_VOTmin`, `selectivityIndexVOT_FTmax` and `selectivityIndexVOT_FTmin`, which are calculated as described in the "indices" section.


## Base stats:
These are additional columns calculated for all cells:
*
*

## Indices:
These are additional columns calculated for a selected set of cells:

* *VOT selectivity index*: A-B/A+B, where A is the average firing rate during the stimulus for the VOT stimulus that evokes the highest FR of the 4 VOT levels (and FT is constant at either max or min), and B is the average firing rate during the stimulus for the VOT stimulus that evokes the lowest FR of the 4 VOT levels (and FT is constant at either max or min)
* *FT selectivity index*: Same as above, but for FT
* *VOT selectivity index 2*: A-B/B, where A and B are as in the first selectivity index.
* *FT selectivity index 2*: same as VOT selectivity index 2, but for FT.

# Generate files
`generate_psycurve_cohortAverages.py` : This generates a population average psychometric stored in `data_cohort_average_psycurves.npz`
`generate_psycurve_exampleMouse.py` :  This generates a psychometric for a single example mouse, stored in `data_example_mice_psycurves.npz`


# Figures

All figures require access to the databases, the clustered ephys data, and the behavior data.

## Figure 1 (Mice can discriminate speech sounds)
Created by `figure_psycurve_exampleMouse.py`.

### Panel A
Psycurve for example mouse performing FT task (using data generated from `generate_psycurve_exampleMouse.py`)
### Panel B
Psycurve for example mouse performing VOT task (using data generated from `generate_psycurve_exampleMouse.py`)
### Panel C
Population averaged Psycurve from the FT cohort (using data generated from `generate_psycurve_cohortAverages.py`)
### Panel D
Population averaged Psycurve from the VOT cohort (using data generated from `generate_psycurve_cohortAverages.py`)
